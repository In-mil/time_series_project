# Time Series Prediction Project

[![GitHub Actions](https://img.shields.io/github/actions/workflow/status/In-mil/time_series_project/dvc_pipeline.yml?branch=main&logo=github)](https://github.com/In-mil/time_series_project/actions)
[![DVC](https://img.shields.io/badge/DVC-enabled-blueviolet?logo=dvc)](https://dvc.org/)
[![MLflow](https://img.shields.io/badge/MLflow-tracking-orange?logo=mlflow)](https://mlflow.org/)
[![Docker](https://img.shields.io/badge/Docker-ready-2496ED?logo=docker)](https://www.docker.com/)
[![Python](https://img.shields.io/badge/Python-3.11+-blue?logo=python)](https://www.python.org/)
[![TensorFlow](https://img.shields.io/badge/TensorFlow-2.15+-orange?logo=tensorflow)](https://www.tensorflow.org/)

---

## Overview

This project implements and compares several **deep learning architectures** for **financial time series forecasting**, using cryptocurrency and macroeconomic data.  
The models are trained and versioned with **DVC**, evaluated via **MLflow**, and deployed through **GitHub Actions**.

---

## Model Architectures

| Model | Type | Key Features | Typical Use Case |
|--------|------|---------------|------------------|
| **ANN (Artificial Neural Network)** | Feedforward dense layers | Simple and fast, no temporal context | Baseline for non-sequential dependencies |
| **GRU (Gated Recurrent Unit)** | Recurrent (2 gates) | Efficient and lightweight | Short-term sequence modeling |
| **LSTM (Long Short-Term Memory)** | Recurrent (3 gates) | Captures long-term dependencies | Complex time dependencies |
| **Transformer** | Attention-based | Learns relationships without recurrence | Scalable sequence processing |
| **Ensemble** | Averaged predictions | Combines model strengths | More stable, generalizable output |

---

##  Tracking & Storage

| Component | Location / Tool | Contents | Managed by |
|------------|------------------|-----------|-------------|
| **Code & Configs** | GitHub Repo (`main` branch) | Python scripts, notebooks, YAMLs | Git |
| **Datasets** | Google Cloud Storage (GCS) → `gs://time-series-dvc-storage/.dvc/cache` | Versioned raw & processed CSV files | DVC |
| **Models** | DVC Remote (GCS) | Trained `.keras` model weights | DVC |
| **Evaluation Reports** | `/reports/metrics.json` | Final metrics (MAE, MSE) | Git |
| **Experiments** | MLflow (`mlflow.db`) | Logged metrics & artifacts | MLflow |
| **CI/CD** | `.github/workflows/dvc_pipeline.yml` | Automated training & evaluation | GitHub Actions |
| **Docker Image** | Google Container Registry (GCR) | Production-ready API container | Docker + GH Actions |


---

## Project Structure

```
.
├── .github/workflows/
│   ├── dvc_pipeline.yml      # Main: Training pipeline
│   ├── dvc-ci.yml            # Alternative CI config
│   └── docker-build.yml      # Docker build & push
├── models/                    # Model training scripts
│   ├── ann_model.py
│   ├── gru_model.py
│   ├── lstm_model.py
│   ├── transformer_model.py
│   └── ensemble_model.py
├── service/
│   └── app.py                # FastAPI prediction API
├── evaluation/
│   └── evaluate_models.py    # Model evaluation
├── data/final_data/
│   └── *.csv.dvc             # DVC-tracked datasets
├── Dockerfile                # Production container
├── build_docker.sh           # Local Docker build
├── dvc.yaml                  # DVC pipeline
└── requirements.txt          # Dependencies
```

---

## CI/CD Pipeline Optimizations

The project features a highly optimized CI/CD pipeline with significant performance improvements:

### Performance Metrics
- **Initial pipeline:** ~60 minutes per run (sequential training)
- **Optimized pipeline:** ~3 minutes when unchanged, ~15 minutes with changes
- **Improvement:** 95% faster for unchanged code, 75% faster for full retraining

### Key Optimizations
1. **Dependency Caching**
   - Python packages cached based on `requirements.txt` hash
   - Reduces installation time from 3 min → 30 sec

2. **DVC Artifact Caching**
   - Models and datasets cached between runs
   - Only pulls what changed
   - Reduces pull time from 2 min → 10 sec

3. **Parallel Model Training**
   - 4 base models train simultaneously instead of sequentially
   - Reduces training time from 50 min → 12 min

4. **Smart Stage Skipping**
   - DVC automatically skips unchanged stages
   - Only retrain models when code/data changes

---

## Live Demo

| Service | URL | Description |
|---------|-----|-------------|
| **FastAPI** |  [Coming Soon] | REST API for predictions |
| **MLflow** |  [Coming Soon] | Experiment tracking UI |
| **Grafana** | [Coming Soon] | Monitoring dashboard |

---

## Local Development

### Prerequisites
- Python 3.11+
- Docker & Docker Compose
- Google Cloud account (for DVC remote)
- DVC installed

### Quick Start

```bash
# Clone repository
git clone https://github.com/In-mil/time_series_project.git
cd time_series_project

# Install dependencies
pip install -r requirements.txt

# Pull models and data from DVC
dvc pull -r gcsremote

# Start services with Docker Compose
docker-compose -f docker-compose.monitoring.yml up -d
```

### Services will be available at:
- FastAPI: http://localhost:8000
- MLflow: http://localhost:5001
- Prometheus: http://localhost:9090
- Grafana: http://localhost:3000

---

                   ┌──────────────────────────────┐
                   │          GitHub              │
                   │  - Source code & notebooks   │
                   │  - CI/CD via Actions         │
                   │  - Workflow: dvc_pipeline.yml│
                   └────────────┬─────────────────┘
                                │
                                ▼
          ┌───────────────────────────────┐
          │       GitHub Actions Runner   │
          │-------------------------------│
          │Pull data/models via DVC   │
          │Train models (ANN, LSTM…)  │
          │Evaluate & log metrics     │
          │Push artifacts to GCS + MLflow │
          └────────────┬────────────────────────┘
                       │
                       ▼
        ┌────────────────────────────────────────┐
        │      DVC + Google Cloud Storage (GCS)  │
        │----------------------------------------│
        │ - Stores large datasets (.csv)         │
        │ - Stores model weights (.keras)        │
        │ - Remote: gs://time-series-dvc-storage │
        └────────────────┬───────────────────────┘
                         │
                         ▼
        ┌────────────────────────────────────────┐
        │          MLflow Tracking Server        │
        │----------------------------------------│
        │ - Runs in Docker container or VM       │
        │ - Stores metrics in mlflow.db          │
        │ - Artifacts also in GCS                │
        │ - Accessible to all teammates          │
        │   via http://<server-ip>:5000          │
        └────────────────┬───────────────────────┘
                         │
                         ▼
       ┌──────────────────────────────────────────┐
       │          FastAPI Inference Service       │
       │------------------------------------------│
       │ - Deployed with Docker or Cloud Run      │
       │ - Loads latest model from DVC cache      │
       │ - Exposes /predict endpoint              │
       │ - Optional REST API for live forecasts   │
       └────────────────┬────────────────────────┘
                         │
                         ▼
         ┌────────────────────────────────────┐
         │         Developer Laptops          │
         │------------------------------------│
         │ - Clone repo via Git               │
         │ - Pull data/models via DVC         │
         │ - Connect to MLflow remotely       │
         │ - Local training via Docker        │
         └────────────────────────────────────┘

